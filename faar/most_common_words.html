<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    body{margin:auto !important;padding:20px;text-align:justify;line-height:140%; -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;color:#222;font-family:Palatino,Georgia,"Times New Roman",serif}
    div{margin: 16px 0 16px 0}
    div.title{font-size:26px;font-weight:800;line-height:120%;text-align:center}
    div.title,contents,h1,h2,h3,h4,h5,h6{font-family:Verdana,Helvetica,Arial,sans-serif;margin:13.4px 0 13.4px;padding:15px 0 3px;border-top:none;clear:both}
    h1{border-bottom:3px solid;font-size:20px;font-weight:bold;}
    h2{border-bottom:2px solid #999;color:#555;font-weight:bold;font-size:18px;}
    h3,h4,h5,h6{font-family:Verdana,Helvetica,Arial,sans-serif;color:#555;font-size:16px;}
    div table{margin:16px 0 16px 0}
    table{border-collapse:collapse;line-height:140%;page-break-inside:avoid;margin:auto}
    table th{color:#FFF;background-color:#8080d4;border:1px solid #888;padding:8px 15px 8px 15px;text-align: right}
    table td{padding:5px 15px 5px 15px;border:1px solid #888;text-align: right}
    table tr:nth-child(even){background:#e6e6f7}
    table th:first-child, table td:first-child{text-align: left}â€‹
    h1::before, h2::before, h3::before, h4::before, h5::before, h6::before {margin-right:10px}
    div.row {flex-wrap: initial;margin-block-start: 0;margin-block-end: 0;}
    div.col-sm {margin-top: 0;margin-bottom: 0;}
    </style>
  </head>
<body>
<p><title>The ~3500 most common words</title></p>
<div class="title">The ~3500 most common words</div>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet"/>

<div class="container" style="max-width: none;">
  <div class="row">
    <div class="col-sm">Display difficulties:</div>
  </div>

  <div class="row">
    <div class="col-sm"><input type="checkbox" id="choiceA1"><label for="choiceA1">A1</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceA2"><label for="choiceA2">A2</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceB1"><label for="choiceB1">B1</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceB2"><label for="choiceB2">B2</label></div>
  </div>

  <div class="row">
    <div class="col-sm">Display word categories:</div>
  </div>

  <div class="row">
    <div class="col-sm"><input type="checkbox" id="choiceN"><label for="choiceN">Nouns</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceA"><label for="choiceA">Adjectives</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceV"><label for="choiceV">Verbs</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceAdv"><label for="choiceAdv">Adverbs</label></div>
  </div>
  <div class="row">
    <div class="col-sm"><input type="checkbox" id="choicePronoun"><label for="choicePronoun">Pronouns</label></div>
    <div class="col-sm"><input type="checkbox" id="choicePre"><label for="choicePre">Prepositions</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceDet"><label for="choiceDet">Determiners</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceNum"><label for="choiceNum">Numbers</label></div>
  </div>
  <div class="row">
    <div class="col-sm"><input type="checkbox" id="choiceCon"><label for="choiceCon">Conjunctions</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceExc"><label for="choiceExc">Exclamations</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceDef"><label for="choiceDef">Definitive article</label></div>
    <div class="col-sm"><input type="checkbox" id="choiceInf"><label for="choiceInf">Infinitive marker</label></div>
  </div>

  <div class="row">
    <div id="ar_prog" class="col-sm"></div>
    <div id="fa_prog" class="col-sm"></div>
  </div>

  <div class="row">
    <div id="wordlist1" class="col-sm"></div>
    <div id="wordlist2" class="col-sm"></div>
    <div id="wordlist3" class="col-sm"></div>
    <div id="wordlist4" class="col-sm"></div>
  </div>
</div>

</body>
</html>
<script>
function createTable(matrix) {
  const table = document.createElement('table');
  table.setAttribute('border', '1');
  table.style.borderSpacing = '0';
  const tbody = document.createElement('tbody');

  const createTDWithTxt = (txt) => {
    const td = document.createElement('td');
    td.appendChild(document.createTextNode(txt));
    return td;
  }
  matrix.forEach(row => {
    const tr = document.createElement('tr');
    let a = document.createElement('a');
    let path = [];
    let row2 = row[1].replace('(to) ', '');
    path.push(row2[0]); //n
    path.push(row2.slice(0, 3).padEnd(3, '_')); //nei, a__
    path.push(row2.slice(0, 5).padEnd(5, '_')); // neith, able_
    a.setAttribute('href', 'https://www.oxfordlearnersdictionaries.com/media/english/uk_pron/' + path.join('/') + '/' + row2 + '__gb_1.mp3');
    a.appendChild(document.createTextNode(row[1]));
    let td = document.createElement('td');
    td.appendChild(a);
    tr.appendChild(td);
    tr.appendChild(createTDWithTxt(row[2]));
    tr.appendChild(createTDWithTxt(row[3]));
    tbody.appendChild(tr);
  })

  table.appendChild(tbody);
  return table;
}

function removeChildren(node) {
  while (node.firstChild) {
    node.removeChild(node.firstChild);
  }
}

function createTables(matrix) {
  const len = matrix.length;
  
  let ar = 0;
  let fa = 0;
  for (let i = 0; i < len; i++) {
    if (matrix[i][2]) {
      ar++;
    }
    if (matrix[i][3]) {
      fa++;
    }
  }
  
  const body1 = document.getElementById('ar_prog');
  removeChildren(body1);
  let par = Math.round(ar * 1000 / len) / 10;
  body1.appendChild(document.createTextNode('Arabic progress: ' + ar + '/' + len +  ' (' + par + '%)'));
  
  const body3 = document.getElementById('fa_prog');
  removeChildren(body3);
  let pfa = Math.round(fa * 1000 / len) / 10;
  body3.appendChild(document.createTextNode('Persian progress: ' + fa + '/' + len +  ' (' + pfa + '%)'));

  const halfLen = Math.round(len/4);
  for (let i = 0; i < 4; i++) {
    let el = document.getElementById('wordlist' + (i+1));
    removeChildren(el);
    el.appendChild(createTable(matrix.slice(halfLen*i, halfLen*(i+1))));
  }
}

let A1 = [];
let A2 = [];
let B1 = [];
let B2 = [];

function regenTable() {
  let ar = [];
  if (document.getElementById('choiceA1').checked) {
    ar = ar.concat(A1);
  }
  if (document.getElementById('choiceA2').checked) {
    ar = ar.concat(A2);
  }
  if (document.getElementById('choiceB1').checked) {
    ar = ar.concat(B1);
  }
  if (document.getElementById('choiceB2').checked) {
    ar = ar.concat(B2);
  }

  let filter = [];
  if (document.getElementById('choiceN').checked) {
    filter.push("n");
  }
  if (document.getElementById('choiceA').checked) {
    filter.push("a");
  }
  if (document.getElementById('choiceV').checked) {
    filter.push("v");
  }
  if (document.getElementById('choiceAdv').checked) {
    filter.push("adv");
  }
  if (document.getElementById('choicePronoun').checked) {
    filter.push("pronoun");
  }
  if (document.getElementById('choicePre').checked) {
    filter.push("pre");
  }
  if (document.getElementById('choiceDet').checked) {
    filter.push("det");
  }
  if (document.getElementById('choiceNum').checked) {
    filter.push("num");
  }
  if (document.getElementById('choiceCon').checked) {
    filter.push("con");
  }
  if (document.getElementById('choiceExc').checked) {
    filter.push("exc");
  }
  if (document.getElementById('choiceDef').checked) {
    filter.push("def");
  }
  if (document.getElementById('choiceInf').checked) {
    filter.push("inf");
  }

  let ar2 = ar.filter(e => e[0].split(", ").some(e => filter.includes(e)));
  ar2.sort((a, b) => a[1].replace('(to) ', '').localeCompare(b[1].replace('(to) ', '')));
  createTables(ar2);
}

function check(which) {
  which.forEach((id) => {
    document.getElementById('choice' + id).checked = true;
  });
  regenTable();
}

let A1Promise = fetch('https://ackelman.github.io/faar/A1.json').then(val => val.json());
let A2Promise = fetch('https://ackelman.github.io/faar/A2.json').then(val => val.json());
let B1Promise = fetch('https://ackelman.github.io/faar/B1.json').then(val => val.json());
let B2Promise = fetch('https://ackelman.github.io/faar/B2.json').then(val => val.json());

Promise.all([A1Promise, A2Promise, B1Promise, B2Promise])
.then(function (values) {
  A1 = values[0];
  A2 = values[1];
  B1 = values[2];
  B2 = values[3];
  
  document.getElementById('choiceA1').addEventListener('click', regenTable);
  document.getElementById('choiceA2').addEventListener('click', regenTable);
  document.getElementById('choiceB1').addEventListener('click', regenTable);
  document.getElementById('choiceB2').addEventListener('click', regenTable);

  document.getElementById('choiceN').addEventListener('click', regenTable);
  document.getElementById('choiceA').addEventListener('click', regenTable);
  document.getElementById('choiceV').addEventListener('click', regenTable);
  document.getElementById('choiceAdv').addEventListener('click', regenTable);
  document.getElementById('choicePronoun').addEventListener('click', regenTable);
  document.getElementById('choicePre').addEventListener('click', regenTable);
  document.getElementById('choiceDet').addEventListener('click', regenTable);
  document.getElementById('choiceNum').addEventListener('click', regenTable);
  document.getElementById('choiceCon').addEventListener('click', regenTable);
  document.getElementById('choiceExc').addEventListener('click', regenTable);
  document.getElementById('choiceDef').addEventListener('click', regenTable);
  document.getElementById('choiceInf').addEventListener('click', regenTable);

  check(['A1', 'A2', 'N', 'A', 'V', 'Adv', 'Pronoun', 'Pre', 'Det', 'Num', 'Con', 'Exc', 'Def', 'Inf']);
})

</script>
