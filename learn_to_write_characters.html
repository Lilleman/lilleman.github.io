<body style="margin: 0">
  <div style="display: flex">
<div style="float: left; width: 50%">
  <textarea id="story" placeholder="Klistra in text här" rows="4" style="width: 100%"></textarea>
</div>
<div style="float: left; width: 50%">
  <label for="animationSpeed">Hastighet:</label><br>
  <input type="range" id="animSpeed" name="animationSpeed" min="0" max="50" value="45"><br>
  <button onclick="draw()" style="font-size: 1.25em">Start</button>
</div>
</div>
<canvas id="canvas"></canvas>
</body>
<script>
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');

let font = {
  ',': {
    isolated: "L0.45,0.85,0.275,1.175"
  },
  '.': {
    isolated: "A0.5,0.925,0.045,0.045,0,2"
  },
  ':': {
    isolated: "A0.5,0.55,0.045,0.045,0,2A0.5,0.925,0.045,0.045,0,2"
  },
  '\'': {
    isolated: "L0.5,0.275,0.5,0.6"
  },
  '"': {
    isolated: "L0.3125,0.275,0.3125,0.6L0.6875,0.275,0.6875,0.6"
  },
  'A': {
    isolated: "L0.075,1,0.5,0.35L0.5,0.35,0.925,1L0.75,0.775,0.25,0.775"
  },
  'B': {
    isolated: "L0.2,0.35,0.2,1L0.2,0.375,0.575,0.375A0.55,0.525,0.25,0.15,-0.5,0.5L0.575,0.675,0.2,0.675A0.55,0.825,0.3,0.15,-0.5,0.5L0.575,0.975,0.2,0.975"
  },
  'C': {
    isolated: "A0.55,0.675,0.375,0.3,1.8,0.15"
  },
  'D': {
    isolated: "L0.2,0.35,0.2,1L0.2,0.375,0.35,0.375A0.35,0.675,0.5,0.3,-0.5,0.5L0.35,0.975,0.2,0.975"
  },
  'E': {
    isolated: "L0.2,0.35,0.2,1L0.85,0.375,0.2,0.375L0.825,0.675,0.2,0.675L0.875,0.975,0.2,0.975"
  },
  'F': {
    isolated: "L0.225,0.35,0.225,1L0.85,0.375,0.2,0.375L0.825,0.675,0.2,0.675"
  },
  'G': {
    isolated: "A0.55,0.675,0.375,0.3,1.8,0.25L0.8,0.95,0.8,0.675L0.85,0.675,0.5,0.675"
  },
  'H': {
    isolated: "L0.2,0.35,0.2,1L0.8,0.35,0.8,1L0.8,0.65,0.2,0.65"
  },
  'I': {
    isolated: "L0.5,0.35,0.5,1"
  },
  'J': {
    isolated: "L0.75,0.35,0.75,0.825A0.5,0.825,0.25,0.15,0,1"
  },
  'K': {
    isolated: "L0.2,0.35,0.2,1L0.85,0.35,0.2,0.75L0.4,0.625,0.9,1"
  },
  'L': {
    isolated: "L0.25,0.35,0.25,1L0.25,0.975,0.875,0.975"
  },
  'M': {
    isolated: "L0.175,1,0.175,0.35L0.2,0.35,0.5,0.775L0.5,0.775,0.8,0.35L0.825,0.35,0.825,1"
  },
  'N': {
    isolated: "L0.2,1,0.2,0.35L0.25,0.35,0.75,1L0.8,1,0.8,0.35"
  },
  'O': {
    isolated: "A0.5,0.675,0.35,0.3,-0.5,1.5"
  },
  'P': {
    isolated: "L0.2,1,0.2,0.35L0.2,0.375,0.575,0.375A0.55,0.5375,0.275,0.1625,-0.5,0.5L0.575,0.7,0.2,0.7"
  },
  'Q': {
    isolated: "A0.5,0.675,0.35,0.3,-0.5,1.5A0.85,0.95,0.35,0.2,1,0.375"
  },
  'R': {
    isolated: "L0.2,1,0.2,0.35L0.2,0.375,0.575,0.375A0.55,0.5375,0.275,0.1625,-0.5,0.5L0.575,0.7,0.2,0.7L0.5,0.7,0.875,1"
  },
  'S': {
    isolated: "A0.5,0.5125,0.325,0.1375,2,0.625L0.325,0.62,0.7,0.6875A0.5,0.8125,0.35,0.15,-0.375,1"
  },
  'T': {
    isolated: "L0.5,0.35,0.5,1L0.075,0.375,0.925,0.375"
  },
  'U': {
    isolated: "L0.2,0.35,0.2,0.8A0.5,0.8,0.3,0.175,1,0L0.8,0.8,0.8,0.35"
  },
  'V': {
    isolated: "L0.1,0.35,0.5,1L0.5,1,0.9,0.35"
  },
  'W': {
    isolated: "L0.1,0.35,0.25,1L0.25,1,0.5,0.55L0.5,0.55,0.75,1L0.75,1,0.9,0.35"
  },
  'X': {
    isolated: "L0.15,0.35,0.875,1L0.85,0.35,0.125,1"
  },
  'Y': {
    isolated: "L0.125,0.35,0.5,0.7L0.875,0.35,0.5,0.7L0.5,0.7,0.5,1"
  },
  'Z': {
    isolated: "L0.1,0.375,0.875,0.375L0.85,0.375,0.1,0.975L0.075,0.975,0.925,0.975"
  },
  'Å': {
    isolated: "L0.075,1,0.5,0.35L0.5,0.35,0.925,1L0.75,0.775,0.25,0.775A0.5,0.3,0.125,0.05,-0.5,1.5"
  },
  'Ä': {
    isolated: "L0.075,1,0.5,0.35L0.5,0.35,0.925,1L0.75,0.775,0.25,0.775A0.325,0.25,0.025,0.025,-0.5,1.5A0.675,0.25,0.025,0.025,-0.5,1.5"
  },
  'Ö': {
    isolated: "A0.5,0.675,0.35,0.3,-0.5,1.5A0.325,0.25,0.025,0.025,-0.5,1.5A0.675,0.25,0.025,0.025,-0.5,1.5"
  },
  'a': {
    isolated: "A0.475,0.6,0.25,0.1,1,2L0.725,0.6,0.725,0.875A0.45,0.85,0.275,0.125,0,1.5L0.45,0.725,0.725,0.725A0.925,0.85,0.2,0.125,1,0.5"
  },
  'b': {
    isolated: "L0.225,0.25,0.225,1A0.55,0.7375,0.275,0.225,1,-1"
  },
  'c': {
    isolated: "A0.55,0.725,0.375,0.225,1.8,0.2"
  },
  'd': {
    isolated: "L0.775,0.25,0.775,1A0.45,0.7375,0.275,0.225,0,2"
  },
  'e': {
    isolated: "L0.25,0.725,0.9,0.725A0.5,0.7375,0.325,0.25,2,0.15"
  },
  'f': {
    isolated: "A0.85,0.425,0.45,0.125,1.5,1L0.4,0.4,0.4,1L0.85,0.5,0.1,0.5"
  },
  'g': {
    isolated: "A0.45,0.7375,0.275,0.225,2,0L0.775,0.475,0.775,1.05A0.5,1.05,0.275,0.125,0,1"
  },
  'h': {
    isolated: "L0.225,0.25,0.225,1A0.5,0.65,0.275,0.15,1,2L0.775,0.65,0.775,1"
  },
  'i': {
    isolated: "L0.525,0.475,0.525,1A0.525,0.325,0.025,0.025,-0.5,1.5"
  },
  'j': {
    isolated: "L0.6,0.475,0.6,1A0.2,0.975,0.4,0.2,0,0.6A0.6,0.325,0.025,0.025,-0.5,1.5"
  },
  'k': {
    isolated: "L0.25,0.25,0.25,1L0.8,0.475,0.25,0.85L0.475,0.725,0.85,1"
  },
  'l': {
    isolated: "L0.525,0.275,0.525,1"
  },
  'm': {
    isolated: "L0.15,0.45,0.15,1A0.325,0.65,0.175,0.15,1,2L0.5,0.65,0.5,1A0.675,0.65,0.175,0.15,1,2L0.85,0.65,0.85,1"
  },
  'n': {
    isolated: "L0.225,0.45,0.225,1A0.5,0.65,0.275,0.15,1,2L0.775,0.65,0.775,1"
  },
  'o': {
    isolated: "A0.5,0.725,0.325,0.25,-0.5,1.5"
  },
  'p': {
    isolated: "L0.225,0.475,0.225,1.225A0.525,0.7375,0.3,0.225,1,3"
  },
  'q': {
    isolated: "A0.475,0.7375,0.3,0.225,2,0L0.775,0.475,0.775,1.225"
  },
  'r': {
    isolated: "L0.3125,1,0.3125,0.475A0.8375,0.7,0.525,0.2,1,1.5"
  },
  's': {
    isolated: "A0.5,0.6125,0.275,0.1125,2,0.625L0.325,0.7,0.7,0.7675A0.5,0.85,0.3,0.1125,-0.375,1"
  },
  't': {
    isolated: "L0.3625,0.325,0.3625,0.875A0.7375,0.85,0.375,0.125,1,0.4L0.775,0.5,0.15,0.5"
  },
  'u': {
    isolated: "L0.225,0.475,0.225,0.8A0.5,0.8,0.275,0.175,1,0L0.775,0.8,0.775,0.475L0.775,0.475,0.775,1"
  },
  'v': {
    isolated: "L0.125,0.45,0.5,1L0.5,1,0.875,0.45"
  },
  'w': {
    isolated: "L0.075,0.45,0.25,1L0.25,1,0.5,0.625L0.5,0.625,0.75,1L0.75,1,0.925,0.45"
  },
  'x': {
    isolated: "L0.15,0.45,0.85,1L0.85,0.45,0.15,1"
  },
  'y': {
    isolated: "L0.125,0.475,0.5,0.975L0.875,0.475,0.5,0.975A0.125,0.975,0.375,0.2,0,0.5"
  },
  'z': {
    isolated: "L0.15,0.5,0.85,0.5L0.8,0.5,0.15,0.975L0.125,0.975,0.875,0.975"
  },
  'å': {
    isolated: "A0.475,0.6,0.25,0.1,1,2L0.725,0.6,0.725,0.875A0.45,0.85,0.275,0.125,0,1.5L0.45,0.725,0.725,0.725A0.925,0.85,0.2,0.125,1,0.5A0.5,0.3375,0.125,0.05,-0.5,1.5"
  },
  'ä': {
    isolated: "A0.475,0.6,0.25,0.1,1,2L0.725,0.6,0.725,0.875A0.45,0.85,0.275,0.125,0,1.5L0.45,0.725,0.725,0.725A0.925,0.85,0.2,0.125,1,0.5A0.35,0.35,0.025,0.025,-0.5,1.5A0.65,0.35,0.025,0.025,-0.5,1.5"
  },
  'ö': {
    isolated: "A0.5,0.725,0.325,0.25,-0.5,1.5A0.35,0.35,0.025,0.025,-0.5,1.5A0.65,0.35,0.025,0.025,-0.5,1.5"
  },
  'ا': {
    isolated: "L0.5,0.25,0.5,1",
    final: "A1,0.7,0.55,0.25,0.5,1L0.45,0.75,0.45,0.25"
  },
  'ب': {
    isolated: "A0.5,0.775,0.375,0.2,-0.125,1.125A0.475,1.13,0.01,0.01,-0.5,1.5",
    initial: "A0,0.7,0.5,0.25,0,0.5A0.5,1.115,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.5,0.25,0.5,1A0,0.7,0.5,0.25,0,0.5A0.5,1.115,0.01,0.01,-0.5,1.5",
    final: "A1,0.65,0.175,0.3,0.5,1A0.45,0.775,0.35,0.2,-0.125,1.125A0.45,1.13,0.01,0.01,-0.5,1.5"
  },
  'پ': {
    isolated: "A0.5,0.775,0.375,0.2,-0.125,1.125A0.4,1.085,0.01,0.01,-0.5,1.5A0.525,1.085,0.01,0.01,-0.5,1.5A0.4625,1.2,0.01,0.01,-0.5,1.5",
    initial: "A0,0.7,0.5,0.25,0,0.5A0.3,1.085,0.01,0.01,-0.5,1.5A0.7,1.085,0.01,0.01,-0.5,1.5A0.5,1.2,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.5,0.25,0.5,1A0,0.7,0.5,0.25,0,0.5A0.3,1.085,0.01,0.01,-0.5,1.5A0.7,1.085,0.01,0.01,-0.5,1.5A0.5,1.2,0.01,0.01,-0.5,1.5",
    final: "A1,0.65,0.175,0.3,0.5,1A0.45,0.775,0.35,0.2,-0.125,1.125A0.375,1.085,0.01,0.01,-0.5,1.5A0.525,1.085,0.01,0.01,-0.5,1.5A0.45,1.2,0.01,0.01,-0.5,1.5"
  },
  'ت': {
    isolated: "A0.5,0.775,0.375,0.2,-0.125,1.125A0.4,0.65,0.01,0.01,-0.5,1.5A0.525,0.65,0.01,0.01,-0.5,1.5",
    initial: "A0,0.7,0.5,0.25,0,0.5A0.3,0.55,0.01,0.01,-0.5,1.5A0.7,0.55,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.5,0.25,0.5,1A0,0.7,0.5,0.25,0,0.5A0.3,0.55,0.01,0.01,-0.5,1.5A0.7,0.55,0.01,0.01,-0.5,1.5",
    final: "A1,0.65,0.175,0.3,0.5,1A0.45,0.775,0.35,0.2,-0.125,1.125A0.3875,0.65,0.01,0.01,-0.5,1.5A0.5125,0.65,0.01,0.01,-0.5,1.5"
  },
  'ث': {
    isolated: "A0.5,0.775,0.375,0.2,-0.125,1.125A0.4,0.65,0.01,0.01,-0.5,1.5A0.525,0.65,0.01,0.01,-0.5,1.5A0.4625,0.525,0.01,0.01,-0.5,1.5",
    initial: "A0,0.7,0.5,0.25,0,0.5A0.3,0.55,0.01,0.01,-0.5,1.5A0.7,0.55,0.01,0.01,-0.5,1.5A0.5,0.425,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.5,0.25,0.5,1A0,0.7,0.5,0.25,0,0.5A0.3,0.55,0.01,0.01,-0.5,1.5A0.7,0.55,0.01,0.01,-0.5,1.5A0.5,0.425,0.01,0.01,-0.5,1.5",
    final: "A1,0.65,0.175,0.3,0.5,1A0.45,0.775,0.35,0.2,-0.125,1.125A0.3875,0.65,0.01,0.01,-0.5,1.5A0.5125,0.65,0.01,0.01,-0.5,1.5A0.45,0.525,0.01,0.01,-0.5,1.5"
  },
  'ج': {
    isolated: "A0.5,0.825,0.6,0.2,1.3,1.675A0.65,0.925,0.45,0.275,1.575,0.3A0.625,0.95,0.01,0.01,-0.5,1.5",
    initial: "A0.15,0.85,0.9,0.2,1.5,1.8A1.2,0.9,0.7,0.2,1.35,1.1A0,0.75,0.6,0.2,0.1,0.5A0.475,1.11,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.35,0.25,0.5,0.9A0.125,0.85,0.9,0.2,1.5,1.8A0.85,0.95,0.45,0.2,1.5,1.1A0,0.75,0.55,0.2,0.1,0.5A0.45,1.11,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.3,0.25,0.5,1.05A0.525,0.825,0.65,0.2,1.3,1.675A0.65,0.95,0.45,0.2625,1.575,0.25A0.59,0.98,0.01,0.01,-0.5,1.5"
  },
  'چ': {
    isolated: "A0.5,0.825,0.6,0.2,1.3,1.675A0.65,0.925,0.45,0.275,1.575,0.3A0.55,0.88,0.01,0.01,-0.5,1.5A0.75,0.88,0.01,0.01,-0.5,1.5A0.65,1,0.01,0.01,-0.5,1.5",
    initial: "A0.15,0.85,0.9,0.2,1.5,1.8A1.2,0.9,0.7,0.2,1.35,1.1A0,0.75,0.6,0.2,0.1,0.5A0.375,1.06,0.01,0.01,-0.5,1.5A0.575,1.06,0.01,0.01,-0.5,1.5A0.475,1.18,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.35,0.25,0.5,0.9A0.125,0.85,0.9,0.2,1.5,1.8A0.85,0.95,0.45,0.2,1.5,1.1A0,0.75,0.55,0.2,0.1,0.5A0.35,1.06,0.01,0.01,-0.5,1.5A0.55,1.06,0.01,0.01,-0.5,1.5A0.45,1.18,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.3,0.25,0.5,1.05A0.525,0.825,0.65,0.2,1.3,1.675A0.65,0.95,0.45,0.2625,1.575,0.25A0.45,0.94,0.01,0.01,-0.5,1.5A0.65,0.94,0.01,0.01,-0.5,1.5A0.55,1.06,0.01,0.01,-0.5,1.5"
  },
  'ح': {
    isolated: "A0.5,0.825,0.6,0.2,1.3,1.675A0.65,0.925,0.45,0.275,1.575,0.3",
    initial: "A0.15,0.85,0.9,0.2,1.5,1.8A1.2,0.9,0.7,0.2,1.35,1.1A0,0.75,0.6,0.2,0.1,0.5",
    medial: "A1,0.7,0.35,0.25,0.5,0.9A0.125,0.85,0.9,0.2,1.5,1.8A0.85,0.95,0.45,0.2,1.5,1.1A0,0.75,0.55,0.2,0.1,0.5",
    final: "A1,0.7,0.3,0.25,0.5,1.05A0.525,0.825,0.65,0.2,1.3,1.675A0.65,0.95,0.45,0.2625,1.575,0.25"
  },
  'خ': {
    isolated: "A0.5,0.825,0.6,0.2,1.3,1.675A0.65,0.925,0.45,0.275,1.575,0.3A0.5,0.45,0.01,0.01,-0.5,1.5",
    initial: "A0.15,0.85,0.9,0.2,1.5,1.8A1.2,0.9,0.7,0.2,1.35,1.1A0,0.75,0.6,0.2,0.1,0.5A0.475,0.5,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.35,0.25,0.5,0.9A0.125,0.85,0.9,0.2,1.5,1.8A0.85,0.95,0.45,0.2,1.5,1.1A0,0.75,0.55,0.2,0.1,0.5A0.45,0.5,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.3,0.25,0.5,1.05A0.525,0.825,0.65,0.2,1.3,1.675A0.65,0.95,0.45,0.2625,1.575,0.25A0.5,0.45,0.01,0.01,-0.5,1.5"
  },
  'د': {
    isolated: "A0.15,0.75,0.65,0.2,-0.45,0.4,0.125",
    final: "A1,0.7,0.375,0.25,0.5,0.9A0.1,0.75,0.6,0.2,-0.45,0.4,0.125"
  },
  'ذ': {
    isolated: "A0.15,0.75,0.65,0.2,-0.45,0.4,0.125A0.45,0.45,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.375,0.25,0.5,0.9A0.1,0.75,0.6,0.2,-0.45,0.4,0.125A0.375,0.45,0.01,0.01,-0.5,1.5"
  },
  'ر': {
    isolated: "A0,0.85,0.8,0.35,-0.1,0.525",
    final: "A1,0.7,0.35,0.25,0.5,0.9A0,0.85,0.7,0.35,-0.1,0.525"
  },
  'ز': {
    isolated: "A0,0.85,0.8,0.35,-0.1,0.525A0.7,0.575,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.35,0.25,0.5,0.9A0,0.85,0.7,0.35,-0.1,0.525A0.625,0.575,0.01,0.01,-0.5,1.5"
  },
  'ژ': {
    isolated: "A0,0.85,0.8,0.35,-0.1,0.525A0.575,0.575,0.01,0.01,-0.5,1.5A0.7,0.45,0.01,0.01,-0.5,1.5A0.825,0.575,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.35,0.25,0.5,0.9A0,0.85,0.7,0.35,-0.1,0.525A0.525,0.575,0.01,0.01,-0.5,1.5A0.625,0.45,0.01,0.01,-0.5,1.5A0.725,0.575,0.01,0.01,-0.5,1.5"
  },
  'س': {
    isolated: "A0.8,0.7,0.11,0.25,-0.125,1A0.575,0.7,0.11,0.25,0,1A0.29,0.9,0.1875,0.325,-0.25,1,0.1",
    initial: "A0.7,0.7,0.1625,0.25,-0.125,1A0.375,0.7,0.1625,0.25,0,1A0,0.7,0.2,0.25,0,0.5",
    medial: "A1,0.7,0.2,0.25,0.5,1.0625A0.65,0.7,0.15,0.25,-0.0625,1A0.3625,0.7,0.15,0.25,0,1A0,0.7,0.2,0.25,0,0.5",
    final: "A1,0.7,0.1375,0.25,0.5,1.0625A0.7625,0.7,0.1,0.25,-0.0625,1A0.55,0.7,0.1,0.25,0,1A0.275,0.9,0.175,0.325,-0.275,1,0.1"
  },
  'ش': {
    isolated: "A0.8,0.7,0.11,0.25,-0.125,1A0.575,0.7,0.11,0.25,0,1A0.29,0.9,0.1875,0.325,-0.25,1,0.1A0.525,0.575,0.01,0.01,-0.5,1.5A0.575,0.45,0.01,0.01,-0.5,1.5A0.625,0.575,0.01,0.01,-0.5,1.5",
    initial: "A0.7,0.7,0.1625,0.25,-0.125,1A0.375,0.7,0.1625,0.25,0,1A0,0.7,0.2,0.25,0,0.5A0.425,0.575,0.01,0.01,-0.5,1.5A0.5,0.45,0.01,0.01,-0.5,1.5A0.575,0.575,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.2,0.25,0.5,1.0625A0.65,0.7,0.15,0.25,-0.0625,1A0.3625,0.7,0.15,0.25,0,1A0,0.7,0.2,0.25,0,0.5A0.4,0.575,0.01,0.01,-0.5,1.5A0.46875,0.45,0.01,0.01,-0.5,1.5A0.5375,0.575,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.1375,0.25,0.5,1.0625A0.7625,0.7,0.1,0.25,-0.0625,1A0.55,0.7,0.1,0.25,0,1A0.275,0.9,0.175,0.325,-0.275,1,0.1A0.5,0.575,0.01,0.01,-0.5,1.5A0.55,0.45,0.01,0.01,-0.5,1.5A0.6,0.575,0.01,0.01,-0.5,1.5"
  },
  'ص': {
    isolated: "A0.725,0.825,0.2,0.12,1,3,-0.1A0.575,0.75,0.125,0.2,0.475,1A0.275,0.9,0.175,0.325,-0.2,1,0.1",
    initial: "A0.6,0.825,0.3,0.12,1,3,-0.1A0.425,0.75,0.2125,0.2,0.475,1A0,0.75,0.2125,0.2,0,0.5",
    medial: "A1,0.75,0.175,0.2,0.5,0.9A0.6,0.825,0.3,0.12,1,3,-0.1A0.425,0.75,0.2125,0.2,0.475,1A0,0.75,0.2125,0.2,0,0.5",
    final: "A1,0.75,0.125,0.2,0.5,0.9A0.7125,0.825,0.2,0.12,1,3,-0.1A0.575,0.75,0.125,0.2,0.475,1A0.275,0.9,0.175,0.325,-0.2,1,0.1"
  },
  'ض': {
    isolated: "A0.725,0.825,0.2,0.12,1,3,-0.1A0.575,0.75,0.125,0.2,0.475,1A0.275,0.9,0.175,0.325,-0.2,1,0.1A0.55,0.575,0.01,0.01,-0.5,1.5",
    initial: "A0.6,0.825,0.3,0.12,1,3,-0.1A0.425,0.75,0.2125,0.2,0.475,1A0,0.75,0.2125,0.2,0,0.5A0.3125,0.575,0.01,0.01,-0.5,1.5",
    medial: "A1,0.75,0.175,0.2,0.5,0.9A0.6,0.825,0.3,0.12,1,3,-0.1A0.425,0.75,0.2125,0.2,0.475,1A0,0.75,0.2125,0.2,0,0.5A0.3125,0.575,0.01,0.01,-0.5,1.5",
    final: "A1,0.75,0.125,0.2,0.5,0.9A0.7125,0.825,0.2,0.12,1,3,-0.1A0.575,0.75,0.125,0.2,0.475,1A0.275,0.9,0.175,0.325,-0.2,1,0.1A0.5375,0.575,0.01,0.01,-0.5,1.5"
  },
  'ط': {
    isolated: "L0.31875,0.25,0.31875,1A0.65,0.825,0.275,0.125,1,3,-0.125L0.425,0.95,0.075,0.95",
    initial: "L0.2125,0.25,0.2125,1A0.6,0.825,0.3,0.125,1,3,-0.125L0.325,0.95,0,0.95",
    medial: "A1,0.75,0.275,0.2,0.5,0.8L0.20625,0.25,0.20625,1A0.575,0.825,0.3,0.125,1,3,-0.125L0.3,0.95,0,0.95",
    final: "A1,0.75,0.25,0.2,0.5,0.8L0.30625,0.25,0.30625,1A0.625,0.825,0.25,0.125,1,3,-0.125L0.425,0.95,0.075,0.95"
  },
  'ظ': {
    isolated: "L0.31875,0.25,0.31875,1A0.65,0.825,0.275,0.125,1,3,-0.125L0.425,0.95,0.075,0.95A0.55,0.55,0.01,0.01,-0.5,1.5",
    initial: "L0.2125,0.25,0.2125,1A0.6,0.825,0.3,0.125,1,3,-0.125L0.325,0.95,0,0.95A0.475,0.55,0.01,0.01,-0.5,1.5",
    medial: "A1,0.75,0.275,0.2,0.5,0.8L0.20625,0.25,0.20625,1A0.575,0.825,0.3,0.125,1,3,-0.125L0.3,0.95,0,0.95A0.475,0.55,0.01,0.01,-0.5,1.5",
    final: "A1,0.75,0.25,0.2,0.5,0.8L0.30625,0.25,0.30625,1A0.625,0.825,0.25,0.125,1,3,-0.125L0.425,0.95,0.075,0.95A0.5375,0.55,0.01,0.01,-0.5,1.5"
  },
  'ع': {
    isolated: "A0.65,0.65,0.4,0.125,1.5,0.625A0.75,0.975,0.6,0.225,1.35,1.5A0.8,0.975,0.65,0.225,1.5,0.4",
    initial: "A0.65,0.7,0.4,0.175,1.5,0.625L0.825,0.775,0.3,0.91A0,0.75,0.5,0.2,0.25,0.5",
    medial: "A1,0.75,0.5,0.2,0.5,0.9A0.5,0.7375,0.225,0.08,0.5,2.5A0,0.75,0.5,0.2,0.1,0.5",
    final: "A1,0.75,0.6,0.2,0.5,0.9A0.475,0.74,0.2,0.08,0.5,2.5A0.8,1,0.6,0.2,1.3,0.3"
  },
  'غ': {
    isolated: "A0.65,0.65,0.4,0.125,1.5,0.625A0.75,0.975,0.6,0.225,1.35,1.5A0.8,0.975,0.65,0.225,1.5,0.4A0.375,0.375,0.01,0.01,-0.5,1.5",
    initial: "A0.725,0.7,0.45,0.175,1.5,0.625L0.925,0.775,0.3,0.925A0,0.75,0.6,0.2,0.25,0.5A0.425,0.375,0.01,0.01,-0.5,1.5",
    medial: "A1,0.75,0.5,0.2,0.5,0.9A0.5,0.7375,0.225,0.08,0.5,2.5A0,0.75,0.5,0.2,0.1,0.5A0.5,0.5,0.01,0.01,-0.5,1.5",
    final: "A1,0.75,0.6,0.2,0.5,0.9A0.475,0.74,0.2,0.08,0.5,2.5A0.8,1,0.6,0.2,1.3,0.3A0.4625,0.5,0.01,0.01,-0.5,1.5"
  },
  'ف': {
    isolated: "A0.7625,0.6825,0.1125,0.1125,0.25,2.25A0.5,0.8,0.375,0.2,-0.125,1.125A0.75,0.4,0.01,0.01,-0.5,1.5",
    initial: "A0.5125,0.6775,0.25,0.1125,0.25,2.25A0.4,0.75,0.375,0.2,-0.0625,0.5L0.45,0.95,0,0.95A0.5125,0.4,0.01,0.01,-0.5,1.5",
    medial: "A1,0.75,0.9,0.2,0.5,0.7A0.5,0.78,0.2125,0.1125,0.5,2.5A0,0.75,0.9,0.2,0.3,0.5A0.5,0.475,0.01,0.01,-0.5,1.5",
    final: "A1,0.75,0.4,0.2,0.5,0.75A0.76,0.78,0.1125,0.1125,0.5,2.5A0.5,0.8,0.375,0.2,0.2,1.125A0.75,0.5,0.01,0.01,-0.5,1.5"
  },
  'ق': {
    isolated: "A0.6925,0.6775,0.15,0.1125,0.25,2.25A0.5,0.8,0.325,0.4,-0.175,0.95,0.125A0.575,0.4,0.01,0.01,-0.5,1.5A0.75,0.4,0.01,0.01,-0.5,1.5",
    initial: "A0.5125,0.6775,0.25,0.1125,0.25,2.25A0.4,0.75,0.375,0.2,-0.0625,0.5L0.45,0.95,0,0.95A0.375,0.4,0.01,0.01,-0.5,1.5A0.625,0.4,0.01,0.01,-0.5,1.5",
    medial: "A1,0.75,0.9,0.2,0.5,0.7A0.5,0.78,0.2125,0.1125,0.5,2.5A0,0.75,0.9,0.2,0.3,0.5A0.375,0.475,0.01,0.01,-0.5,1.5A0.625,0.475,0.01,0.01,-0.5,1.5",
    final: "A1,0.75,0.9,0.2,0.5,0.65A0.6425,0.8125,0.1375,0.125,0.5,2L0.78,0.8075,0.78,1A0.5,0.8,0.35,0.425,0,0.825,0.125A0.575,0.54,0.01,0.01,-0.5,1.5A0.725,0.54,0.01,0.01,-0.5,1.5"
  },
  'ک': {
    isolated: "L1,0.2875,0.5,0.475L0.525,0.475,0.8,0.8A0.45,0.8,0.325,0.2,-0.125,1.125",
    initial: "L1,0.2875,0.075,0.4625L0.075,0.4625,0.65,0.8A0.3,0.8,0.325,0.15,-0.0625,0.5L0.3,0.95,0,0.95",
    medial: "A1,0.75,0.425,0.2,0.5,0.9L0.9,0.275,0.075,0.4625L0.075,0.4625,0.625,0.85A0.125,0.8,0.4,0.15,-0.05,0.5L0.15,0.95,0,0.95",
    final: "A1,0.7,0.175,0.25,0.5,0.8L1,0.2875,0.5,0.475L0.5125,0.475,0.9,0.9A0.45,0.8,0.325,0.2,-0.125,1.125"
  },
  'گ': {
    isolated: "L1,0.2875,0.5,0.475L0.525,0.475,0.8,0.8A0.45,0.8,0.325,0.2,-0.125,1.125L1,0.15,0.525,0.325",
    initial: "L1,0.2875,0.075,0.4625L0.075,0.4625,0.65,0.8A0.3,0.8,0.325,0.15,-0.0625,0.5L0.3,0.95,0,0.95L0.975,0.15,0.125,0.325",
    medial: "A1,0.75,0.425,0.2,0.5,0.9L0.9,0.275,0.075,0.4625L0.075,0.4625,0.625,0.85A0.125,0.8,0.4,0.15,-0.05,0.5L0.15,0.95,0,0.95L0.85,0.15,0.1,0.325",
    final: "A1,0.7,0.175,0.25,0.5,0.8L1,0.2875,0.5,0.475L0.5125,0.475,0.9,0.9A0.45,0.8,0.325,0.2,-0.125,1.125L1,0.15,0.525,0.325"
  },
  'ل': {
    isolated: "L0.81,0.25,0.81,0.925A0.475,0.9,0.325,0.2,0,1.125",
    initial: "L0.55,0.25,0.55,0.8A0,0.8,0.55,0.15,0,0.5",
    medial: "A1,0.8,0.5,0.15,0.5,1L0.5,0.25,0.5,0.8A0,0.8,0.5,0.15,0,0.5",
    final: "A1,0.8,0.225,0.15,0.5,1L0.775,0.25,0.775,0.9A0.475,0.9,0.3,0.2,0,1.125"
  },
  'م': {
    isolated: "A0.6,0.8,0.2,0.125,0.125,2.125A0.375,1.025,0.1875,0.15,1.675,1L0.1875,1,0.1875,1.25",
    initial: "A0.5375,0.8625,0.225,0.125,0.125,2.125A0,0.8,0.35,0.15,0.125,0.5",
    medial: "A1,0.8,0.35,0.15,0.5,0.75A0.5,0.8625,0.225,0.125,0.125,2.125A0,0.8,0.35,0.15,0.25,0.5",
    final: "A1,0.8,0.3,0.15,0.5,0.75A0.5625,0.8625,0.2,0.125,0.125,2.125A0.375,1.025,0.1875,0.1,1.5,1L0.175,1,0.175,1.25"
  },
  'ن': {
    isolated: "A0.4875,0.825,0.3375,0.3,-0.2,1.075A0.425,0.575,0.01,0.01,-0.5,1.5",
    initial: "A0,0.7,0.5,0.25,0,0.5A0.5,0.55,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.5,0.25,0.5,1A0,0.7,0.5,0.25,0,0.5A0.5,0.55,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.225,0.25,0.5,1A0.475,0.9,0.325,0.3,-0.2,1.075A0.425,0.7,0.01,0.01,-0.5,1.5"
  },
  'و': {
    isolated: "A0.5,0.85,0.25,0.12,0.125,2.125A-0.05,0.95,0.8,0.25,-0.05,0.525",
    final: "A1,0.8,0.5,0.15,0.5,0.75A0.475,0.85,0.225,0.12,0.125,2.125A-0.05,0.95,0.75,0.25,-0.05,0.525"
  },
  'ه': {
    isolated: "A0.5,0.85,0.3,0.15,0.25,2.25",
    initial: "A-0.1,0.875,1,0.35,-0.5,-0.15,0.125A0.6,0.9,0.2,0.1,-0.15,0.9A0.375,0.775,0.2,0.125,0.5,2.5L0.375,0.95,-0.05,0.95",
    medial: "L1,0.95,0.4,0.95A0.5,0.825,0.175,0.15,0.25,2.25,0.25A0.5,1.075,0.175,0.15,1.75,-0.25,-0.25L0.5,0.95,0,0.95",
    final: "A1,0.65,0.37,0.3,0.5,1.05A0.475,0.8375,0.275,0.1,0.15,1.75"
  },
  'ی': {
    isolated: "A0.6875,0.725,0.175,0.09,2,0.5A0.4625,0.9375,0.35,0.15,-0.375,1.25",
    initial: "A0,0.7,0.5,0.25,0,0.5A0.275,1.11,0.01,0.01,-0.5,1.5A0.725,1.11,0.01,0.01,-0.5,1.5",
    medial: "A1,0.7,0.5,0.25,0.5,1A0,0.7,0.5,0.25,0,0.5A0.3,1.11,0.01,0.01,-0.5,1.5A0.7,1.11,0.01,0.01,-0.5,1.5",
    final: "A1,0.7,0.175,0.25,0.5,0.875A0.775,0.875,0.1,0.075,2,0.725A0.625,0.975,0.1,0.075,-0.25,0.375A0.425,0.95,0.3,0.15,0,1.25"
  }
}

const FONT_SIZE = 80;
const DRAW_VERT_LINES = false;

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

let animationTime = 0;
let timeBetweenChars = animationTime * 20;

function calcNumDots() {
  for (let i = 'ا'.charCodeAt(0); i <= 'ی'.charCodeAt(0); i++) {
    let c = String.fromCharCode(i);
    let info = font[c];
    if (!info) {
      continue;
    }
    font[c].dots = 0;
  }
  for (let i = 'ا'.charCodeAt(0); i <= 'ی'.charCodeAt(0); i++) {
    let c = String.fromCharCode(i);
    let info = font[c];
    if (!info) {
      continue;
    }
    let width = ctx.measureText(c).width;
    if (info.initial) {
      let init = info.initial.match(/[A-Z][0-9,.-]*/g);
      for (let p = 0; p < init.length; p++) {
        let elem = init[p];
        let op = elem[0];
        elem = elem.substr(1).split(',');
        let rx = Number(elem[2]);
        let ry = Number(elem[3]);
        let isDot = op === 'A' && rx * width < FONT_SIZE * 0.075 && ry < 0.075;
        font[c].dots = font[c].dots + Number(isDot);
      }
    }
  }
}

calcNumDots();

async function animateArc(x, y, rx, ry, a1, a2, rot) {
  let antiCC = a1 > a2;
  if (rx < 5 && ry < 5) {
    let steps = 2;
    if (timeBetweenChars > 0) await sleep(timeBetweenChars); 
    for (let i = 0; i <= steps; i++) {
      let a3 = a1 + (a2 - a1) * i / steps;
      ctx.beginPath();
      ctx.ellipse(x, y, rx, ry, rot, a1, a3, antiCC);
      ctx.stroke();
    }
    return;
  }
  let steps = Math.abs((a2 - a1) * 180 / Math.PI) / 4;
  for (let i = 0; i <= steps; i++) {
    let a3 = a1 + (a2 - a1) * i / steps;
    ctx.beginPath();
    ctx.ellipse(x, y, rx, ry, rot, a1, a3, antiCC);
    ctx.stroke();
    if (animationTime > 0) await sleep(animationTime); 
  }
}

async function animateLine(x1, y1, x2, y2) {
  let steps = Math.max(Math.abs(x2 - x1), Math.abs(y2 - y1));
  for (let i = 0; i <= steps; i++) {
    let x3 = x1 + (x2 - x1) * i / steps;
    let y3 = y1 + (y2 - y1) * i / steps;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x3, y3);
    ctx.stroke();
    if (animationTime > 0) await sleep(animationTime); 
  }
}

async function drawSpline(path, x, y, width, height) {
  y -= height;
  let elem = path.substr(1).split(',');
  if (path[0] === 'A') {
    let cx = Number(elem[0]);
    let cy = Number(elem[1]);
    let rx = Number(elem[2]);
    let ry = Number(elem[3]);
    let sa = Number(elem[4]) * Math.PI;
    let ea = Number(elem[5]) * Math.PI;
    let rot = (elem.length > 6) ? (Number(elem[6]) * Math.PI) : 0;
    await animateArc(x + cx * width, y + cy * height,
      rx * width, ry * height, sa, ea, rot);
  } else {
    let x1 = Number(elem[0]);
    let y1 = Number(elem[1]);
    let x2 = Number(elem[2]);
    let y2 = Number(elem[3]);
    await animateLine(x + x1 * width, y + y1 * height,
      x + x2 * width, y + y2 * height);
  }
}

function getWidth(text, idx) {
  let cc;
  let char = text[idx];
  let info = font[char];
  if (!info) {
    return ctx.measureText(char).width;
  }
  if (!mostlyArabic(char)) {
    return ctx.measureText(char).width;
  }
  if (char.charCodeAt(0) === 'پ'.charCodeAt(0)) {
    cc = parseInt('FB56', 16);
  } else if (char.charCodeAt(0) === 'چ'.charCodeAt(0)) {
    cc = parseInt('FB7A', 16);
  } else if (char.charCodeAt(0) === 'ژ'.charCodeAt(0)) {
    cc = parseInt('FB8A', 16);
  } else if (char.charCodeAt(0) === 'گ'.charCodeAt(0)) {
    cc = parseInt('FB92', 16);
  } else if (char.charCodeAt(0) === 'ک'.charCodeAt(0)) {
    cc = parseInt('FB8E', 16);
  } else {
    let noConnect = ['ا', 'د', 'ذ', 'ر', 'ز', 'ژ', 'و', 'آ', 'ة', 'ى'];
    let num = 0;
    for (let cc = 'ا'.charCodeAt(0); cc < Math.min(char.charCodeAt(0), 'غ'.charCodeAt(0)+1); cc++) {
      num += (noConnect.includes(String.fromCharCode(cc))) ? 2 : 4;
    }
    for (let cc = 'ف'.charCodeAt(0); cc < char.charCodeAt(0); cc++) {
      num += (noConnect.includes(String.fromCharCode(cc))) ? 2 : 4;
    }
    cc = parseInt('FE8D', 16) + num;
  }
  let initial = (idx === 0 || (idx > 0 && (!mostlyArabic(text[idx-1]) || font[text[idx-1]].medial === undefined)));
  let final = (idx === text.length - 1 || (idx < text.length - 1 && !mostlyArabic(text[idx+1])));
  if (initial && !final) {
    cc = (info.initial) ? cc + 2 : cc;
  } else if (final && !initial) {
    cc++;
  } else if (!initial && !final) {
    cc = (info.medial) ? cc + 3 : cc + 1;
  }
  if (char.charCodeAt(0) === 'ی'.charCodeAt(0)) {
    cc = parseInt('FEEF', 16);
    if (initial && !final) {
      cc += 4;
    } else if (final && !initial) {
      cc++;
    } else if (!initial && !final) {
      cc += 5;
    }
  }
  let c = String.fromCharCode(cc);
  return ctx.measureText(c).width;
}

function mostlyArabic(str) {
  let num = 0;
  for (let i = 0; i < str.length; i++) {
    num += Number(str.charCodeAt(i) >= 'ا'.charCodeAt(0));
  }
  return num >= (str.length / 2);
}

function getPaths(info, text, idx) {
  if (!info) {
    return null;
  }
  if (mostlyArabic(text[idx])) {
    let initial = (idx === 0 || (idx > 0 && (!mostlyArabic(text[idx-1]) || font[text[idx-1]].medial === undefined)));
    let final = (idx === text.length - 1 || (idx < text.length - 1 && !mostlyArabic(text[idx+1])));
    if (initial && final) {
      return info.isolated;
    } else if (initial) {
      return info.initial || info.isolated;
    } else if (final) {
      return info.final;
    } else if (!initial && !final) {
      return info.medial || info.final;
    }
  } else {
    return info.isolated;
  }
}

async function addDots(text, startIdx, endIdx, x, y) {
  let x2 = x;
  let rightAlign = mostlyArabic(text);
  if (rightAlign) {
    x2 += ctx.measureText(text).width;
  }
  for (let i = 0; i < startIdx; i++) {
      x2 -= getWidth(text, i);
  }
  for (let i = startIdx; i <= endIdx; i++) {
    if (rightAlign) {
      x2 -= getWidth(text, i);
    }
    let info = font[text[i]];
    let width = getWidth(text, i);
    let paths = getPaths(info, text, i);
    let paths2 = paths.match(/[A-Z][0-9,.-]*/g);
    for (let i = paths2.length - 1; i >= paths2.length - info.dots; i--) {
      await drawSpline(paths2[i], x2, y, width, FONT_SIZE);
    }
  }
}

async function drawCharacter(text, idx, x, y) {
  let info = font[text[idx]];
  if (!info) {
    return;
  }
  let width = getWidth(text, idx);
  let paths = getPaths(info, text, idx);
  let dots = (paths === info.initial || paths === info.medial) ? info.dots : 0;
  let paths2 = paths.match(/[A-Z][0-9,.-]*/g);
  for (let i = 0; i < paths2.length - dots; i++) {
    await drawSpline(paths2[i], x, y, width, FONT_SIZE);
  }
}

async function drawText(text, x, y, drawOutline = false) {
  if (drawOutline) {
    ctx.strokeStyle = '#AAAAAA';
    ctx.lineWidth = 1;
    ctx.strokeText(text, x, y);
  }
  ctx.fillStyle = ctx.strokeStyle = '#404040';
  ctx.lineWidth = FONT_SIZE * 0.075;
  let x2 = x;
  let rightAlign = mostlyArabic(text);
  if (rightAlign) {
    x2 += ctx.measureText(text).width;
  }
  let startIdx = -1;
  for (let i = 0; i < text.length; i++) {
    if (rightAlign) {
      x2 -= getWidth(text, i);
    }
    let info = font[text[i]];
    let paths = getPaths(info, text, i);
    if (info && info.initial && paths === info.initial) {
      startIdx = i;
    }
    await drawCharacter(text, i, x2, y);
    if (info && info.final && paths === info.final && startIdx > -1) {
      await addDots(text, startIdx, i, x, y);
      startIdx = -1;
    }
    if (timeBetweenChars > 0 && info && !(paths === info.initial || paths === info.medial)) await sleep(timeBetweenChars); 
    if (!rightAlign) {
      x2 += ctx.measureText(text[i]).width;
    }
  }
}

function resizeCanvas(lines) {
  canvas.width = lines.map(e => ctx.measureText(e).width).reduce((a, b) => Math.max(a, b));
  canvas.height = FONT_SIZE * lines.length + FONT_SIZE / 2;
  ctx.font = String(FONT_SIZE) + 'px Courier New';
  ctx.fillStyle = '#F5F5E6';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function splitLines(text) {
  if (text.includes('\n')) {
    return text.split('\n');
  }
  canvas.width = document.body.clientWidth;
  ctx.font = String(FONT_SIZE) + 'px Courier New';
  let tmp = text.split(' ');
  let lines = [tmp.shift()];
  while (tmp.length > 0) {
    if (ctx.measureText(lines[lines.length - 1] + ' ' + tmp[0]).width > canvas.width) {
      lines.push(tmp.shift());
      continue;
    }
    lines[lines.length - 1] += ' ' + tmp.shift();
  }
  return lines;
}

function drawHorizLines(lines) {
  ctx.strokeStyle = '#AAAAAA';
  ctx.lineWidth = 2;
  let maxLen = lines.map(e => ctx.measureText(e).width).reduce((a, b) => Math.max(a, b));
  for (let i = 0; i < lines.length; i++) {
    ctx.beginPath();
    let rightAlign = mostlyArabic(lines[i]);
    if (true) {
      ctx.moveTo(rightAlign ? canvas.width : 0, (i+1)*FONT_SIZE);
      ctx.lineTo(rightAlign ? (canvas.width - maxLen) : maxLen, (i+1)*FONT_SIZE);
    }
    ctx.stroke();
  }
}

function drawVertLines(lines) {
  if (!DRAW_VERT_LINES) {
    return;
  }

  for (let l = 0; l < lines.length; l++) {
    let x = canvas.width;
    for (let i = 0; i < lines[l].length; i++) {
      if (!mostlyArabic(lines[l])) {
        ctx.beginPath();
        ctx.moveTo(ctx.measureText(lines[l].substr(0, i+1)).width, FONT_SIZE/4 + l*FONT_SIZE);
        ctx.lineTo(ctx.measureText(lines[l].substr(0, i+1)).width, (l+1) * FONT_SIZE+FONT_SIZE/4);
        ctx.stroke();
      } else {
        let w = getWidth(lines[l], i);
        x -= w;
        ctx.beginPath();
        ctx.moveTo(x, FONT_SIZE/4 + l*FONT_SIZE);
        ctx.lineTo(x, (l+1) * FONT_SIZE+FONT_SIZE/4);
        ctx.stroke();
      }    
    }
  }
}

async function draw() {
  ctx.font = String(FONT_SIZE) + 'px Courier New';
  let text = document.getElementById('story').value;
  animationTime = 50 - document.getElementById('animSpeed').value;
  timeBetweenChars = animationTime * 20;
  let txt1 = 'Följande är\nrefrängen till\n"Farda Soraghe Man\nBia" av Ali Azimi:'
  let txt2 = 'تاریکم\nفردا سراغ من بیا\nیک روز زیبا سراغ من بیا';
  //text = txt1 + '\n' + txt2;
  let lines = splitLines(text);
  resizeCanvas(lines);
  drawHorizLines(lines);
  drawVertLines(lines);
  for (let i = 0; i < lines.length; i++) {
    let ox = mostlyArabic(lines[i]) ? (canvas.width - ctx.measureText(lines[i]).width) : 0;
    await drawText(lines[i], ox, (i+1)*FONT_SIZE);
  }
}
</script>